@section Scripts {
    @Scripts.Render("~/bundles/app")
}

<div class="row">

    <div class="form-group error-messages" data-bind="foreach: errors">
        <div class="alert alert-danger">
            <p data-bind="text: $data" />
        </div>

    </div>
</div>

<div class="row">
    <div class="col-sm-4">
        <div class="form-group">
            <h2>Login</h2>
        </div>
        <div class="form-group">
            <label>Email:</label>
                <input type="text" class="form-control" id="username" placeholder="Username" name="username">
        </div>
        <div class="form-group">
            <label >Password:</label>
                <input type="password" class="form-control" id="password" placeholder="Enter password" name="password">
        </div>
        <div class="form-group">
                <button class="btn btn-default" onclick="login();">Login</button>
        </div>
        <div class="form-group">
                <button class="btn btn-default" onclick="logout();">Logout</button>
        </div>
        <div class="form-group">
                <button class="btn btn-default" onclick="testApiCall();">Test</button>
        </div>
    </div>

    <div class="col-sm-4">
        <div class="form-group">
            <h2>Register</h2>
        </div>
        <div class="form-group">
            <label>Email:</label>
                <input type="text" class="form-control" id="username1" placeholder="Username" name="username1">
        </div>
        <div class="form-group">
            <label>Password:</label>
                <input type="password" class="form-control" id="password1" placeholder="Enter password" name="password1">
        </div>
        <div class="form-group">
            <label>Confirm Password:</label>
                <input type="password" class="form-control" id="password2" placeholder="Confirm password" name="password2">
        </div>
        <div class="form-group">
                <button class="btn btn-default" onclick="register();">Submit</button>
        </div>

    </div>
</div>

<script>

    function testApiCall() {

        var token = sessionStorage.getItem('rrs-token');
        var headers = {};
        if (token) {
            headers.Authorization = 'Bearer ' + token;
        }

        $.ajax({
            type: 'GET',
            url: '/api/values',
            headers: headers
        }).done(function (data) {
            alert(data);
        }).fail(function () {
            alert('Test Failed');
        });
    }

    function logout() {
        // Log out from the cookie based logon.
        var token = sessionStorage.getItem('rrs-token');
        var headers = {};
        if (token) {
            headers.Authorization = 'Bearer ' + token;
        }

        $.ajax({
            type: 'POST',
            url: '/api/Account/Logout',
            headers: headers
        }).done(function (data) {
            // Successfully logged out. Delete the token.
            sessionStorage.removeItem('rrs-token');
            alert('Logged Out');
        }).fail(function () {
            alert('Logout failed');
        });
    }
    function login() {

        var loginData = {
            grant_type: 'password',
            username: $('#username').val(),
            password: $('#password').val()
        };

        $.ajax({
            type: 'POST',
            url: '/Token',
            data: loginData
        }).done(function (data) {
            alert(data.userName);
            // Cache the access token in session storage.
            sessionStorage.setItem('rrs-token', data.access_token);
        }).fail(function (data) {
            alert(data);
        });
    }

    function register() {

        var data = {
            Email: $('#username1').val(),
            Password: $('#password1').val(),
            ConfirmPassword: $('#password2').val()
        };

        $.ajax({
            type: 'POST',
            url: '/api/Account/Register',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (data) {
            alert('Registered');
        }).fail(function (data) {

        });
    }


</script>
